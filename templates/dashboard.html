{{define "content"}}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h2>üéØ Painel do Quiz</h2>        <div class="stats-grid" 
             id="stats-container"
             hx-get="/api/stats/render"
             hx-trigger="load, every 30s"
             hx-swap="innerHTML">
            <!-- Stats carregadas via HTMX -->
            <div class="stat-card">
                <div class="stat-number">-</div>
                <div class="stat-label">Carregando...</div>
            </div>
        </div>
    </div>

    <div class="dashboard-content">
        <div class="questions-section">
            <div class="section-header">
                <h3>üíù Suas Perguntas</h3>                <button 
                    class="btn btn-refresh"
                    hx-get="/api/questions/render"
                    hx-target="#questions-container"
                    hx-swap="innerHTML"
                    hx-indicator="#loading-questions"
                    title="Atualizar"
                >
                    üîÑ Atualizar
                </button>
            </div>

            <div id="loading-questions" class="loading htmx-indicator">
                Carregando perguntas...
            </div>

            <div id="questions-container" 
                 hx-get="/api/questions/render"
                 hx-trigger="load, every 60s"
                 hx-swap="innerHTML">
                <!-- Perguntas carregadas via HTMX -->
            </div>
        </div>
    </div>
</div>

<!-- Modal para respostas -->
<div id="answer-modal" class="form-modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üíï Responder Pergunta</h3>
            <button class="close-modal" onclick="closeAnswerModal()">&times;</button>
        </div>
        <div id="answer-form-content">
            <!-- Formul√°rio carregado via HTMX -->
        </div>
    </div>
</div>

<script>
function openAnswerModal(questionId) {
    document.getElementById('answer-modal').style.display = 'flex';
    htmx.ajax('GET', `/api/questions/${questionId}/form`, {
        target: '#answer-form-content'
    });
}

function closeAnswerModal() {
    document.getElementById('answer-modal').style.display = 'none';
}

// Fechar modal ao clicar fora
document.getElementById('answer-modal').onclick = function(e) {
    if (e.target === this) {
        closeAnswerModal();
    }
}
</script>

<!-- Modal for question details -->
<div id="question-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-title">Pergunta</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body" id="modal-body">
            <!-- Question content will be loaded here -->
        </div>
    </div>
</div>

<script>
// Load dashboard data on page load
document.addEventListener('DOMContentLoaded', function() {
    loadDashboard();
});

function loadDashboard() {
    htmx.ajax('GET', '/api/dashboard', {
        target: '#dashboard-content',
        swap: 'innerHTML'
    });
}

function openQuestionModal(questionId) {
    // Load question details in modal
    htmx.ajax('GET', `/api/questions/${questionId}`, {
        target: '#modal-body',
        swap: 'innerHTML'
    });
    document.getElementById('question-modal').style.display = 'flex';
}

function closeModal() {
    document.getElementById('question-modal').style.display = 'none';
}

// Auto-refresh every 30 seconds to check for new available questions
setInterval(loadDashboard, 30000);

// Handle answer submission
document.body.addEventListener('htmx:afterRequest', function(evt) {
    if (evt.detail.pathInfo.requestPath.includes('/api/answer')) {
        if (evt.detail.xhr.status === 200) {
            const response = JSON.parse(evt.detail.xhr.responseText);
            if (response.is_correct) {
                showToast(`üéâ ${response.congratulations}\nüíù Recompensa: ${response.reward}`, 'success');
            } else {
                showToast(response.feedback, 'info');
            }
            closeModal();
            loadDashboard(); // Refresh dashboard
        }
    }
});
</script>
{{end}}
