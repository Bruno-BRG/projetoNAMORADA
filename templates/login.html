{{define "content"}}
<div class="login-container">
    <div class="login-card">
        <div class="login-header">
            <h2>💝 Bem-vinda ao Quiz do Amor</h2>
            <p>Entre para descobrir as surpresas que preparei para você!</p>
        </div>

        <form 
            class="login-form"
            hx-post="/api/login"
            hx-trigger="submit"
            hx-target="#login-result"
            hx-swap="innerHTML"
            hx-on="htmx:beforeRequest: showLoading()"
            hx-on="htmx:afterRequest: hideLoading()"
        >
            <div class="form-group">
                <label for="username">Usuário</label>
                <input 
                    type="text" 
                    id="username" 
                    name="username" 
                    required 
                    placeholder="Digite seu usuário"
                >
            </div>

            <div class="form-group">
                <label for="password">Senha</label>
                <input 
                    type="password" 
                    id="password" 
                    name="password" 
                    required 
                    placeholder="Digite sua senha"
                >
            </div>

            <button type="submit" class="btn btn-primary btn-login">
                Entrar 💕
            </button>
        </form>

        <div id="login-result" class="login-result"></div>

        <div class="login-footer">
            <p>🌟 Cada pergunta tem um horário especial para ser liberada</p>
            <p>💖 Respostas corretas garantem recompensas especiais</p>
        </div>
    </div>
</div>

<script>
// Handle successful login
document.body.addEventListener('htmx:afterRequest', function(evt) {
    if (evt.detail.xhr.status === 200 && evt.detail.pathInfo.requestPath === '/api/login') {
        try {
            const response = JSON.parse(evt.detail.xhr.responseText);
            if (response.message === 'Login successful') {
                showToast('Login realizado com sucesso! 🎉', 'success');
                setTimeout(() => {
                    window.location.href = response.user.role === 'admin' ? '/admin' : '/dashboard';
                }, 1000);
            }
        } catch (e) {
            console.error('Error parsing login response:', e);
        }
    }
});

// Handle login errors
document.body.addEventListener('htmx:responseError', function(evt) {
    if (evt.detail.pathInfo.requestPath === '/api/login') {
        try {
            const response = JSON.parse(evt.detail.xhr.responseText);
            document.getElementById('login-result').innerHTML = 
                `<div class="alert alert-error">${response.error}</div>`;
        } catch (e) {
            document.getElementById('login-result').innerHTML = 
                '<div class="alert alert-error">Erro de conexão. Tente novamente.</div>';
        }
    }
});
</script>
{{end}}
